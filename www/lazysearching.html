<html> 
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    
    <title>Consumer Assistant</title> 
    <link rel="stylesheet"  href="css/style.css" /> 
    <link rel="stylesheet"  href="css/jquery.mobile-1.2.0.css" />  
</head>

<body> 
<!-- search products-------------------------------------------------- --> 
<div data-role="page" id="pageSearchProduct">
 
	<div data-role="header" data-position="fixed" id="hdrLazySearch">
    
	    <div class="headerlogo"> </div>
	    <div class="headertext">
	       Search Products
	    </div>
	    <div data-role="controlgroup" data-type="horizontal" style="float:right;" >
	        <a href="home.html" rel="external" data-role="button" >Home</a>
			<a href="?" data-role="button" >Back</a>
		</div>
  	</div>
 
  	<div data-role="content" id="contentLazySearch"> 
	    <p> Drop your search keywords here.We will guide you through the best available products</p> 
	    
	    <div id="setErrorMessage" style="color:red;">
	    	
    	</div>
	    
	    <form name="lazysearchform"  >
	    	<div align="center" data-role="fieldcontain">
		         <input type="text" name="searchkey"  placeholder="Enter Search Key" id="searchkey" value="" data-mini="true" />
		    </div>
		
		   	<div class="ui-body">
			<fieldset class="ui-grid-a">
					<div class="ui-block-a"><button type="reset" data-theme="d" data-mini="true">Cancel</button></div>
					<div class="ui-block-b"><button id="searchproduct" type="submit" data-theme="a" data-mini="true">Search</button></div>
		    </fieldset>
			</div>
		</form> 
		<div id="getProductCount">
    	
    	</div>
  	</div>
	
	<div data-role="content" id="contentResultList" name="contentResultList">	
	 <div id="resultContainer" >
	 
	 </div>
	</div>
	
	<div data-role="footer" id="ftrLazySearch">
	     <h1></h1>
	</div>
	  
	  
	 <!-- contentTransition is displayed after the form is submitted until a response is received back. -->
	<div data-role="content" id="contentTransition" name="contentTransition">	
		 <div align="CENTER"><h4>Please wait.</h4></div>
		 <div align="CENTER"><img id="spin" name="spin" src="./css/images/ajax-loader.gif"/></div>
	</div>	<!-- contentTransition -->

 	
<script src="js/jquery.js"></script>
<script src="js/jquery.mobile-1.2.0.js"></script>

<script type="text/javascript">
	var resobj="";
	var productcount="";
	$(document).ready(function() {
		showSearchProductForm();
	});
	
	$('#searchproduct').click( function ()  {
		showTransition();
		doProcessInputs();
		return false;  // !mandatory
	});
	
	function showSearchProductForm()
	{
		$('#contentTransition').hide();
		$('#hdrLazySearch').show();
		$('#contentLazySearch').show();
		$('#ftrLazySearch').show();
	}
	
	function showTransition()
	{
		$('#hdrLazySearch').hide();
		$('#contentLazySearch').hide();
		$('#ftrLazySearch').hide();
		$('#contentTransition').show();
	}

	function showSuccess()
	{
		$('#contentTransition').hide();
		$('#hdrLazySearch').show();
		$('#contentLazySearch').show();
		$('#ftrLazySearch').show();
	}

	//utility methodes	
	function doProcessInputs()
	{
		
		var searchkey=$("#searchkey").val();
		var serviceurl = '../services/lazysearchaction.php' ;
		
		$.post(
			serviceurl ,
			{ 	
			    searchkey : searchkey,             
				action:'searchproduct'	
			} ,
		 	function(data){
		 	    
			    resobj =jQuery.parseJSON(data);
			    productcount=resobj.length;
			    displayProductCount(productcount);
			}
		);  // end of $.post 
	}
	
	function displayProductCount(productcount)
	{
		showSuccess();
		$('#getProductCount').html(
			productcount+" products matches your search"+"<a href='javascript:populateResult()'> Click Here </a>"
		);
	}
	
	function populateResult() {
		$('#hdrLazySearch').hide();  //common header 
		$('#contentLazySearch').hide(); // content data-role you created now.
		$('#contentResultList').show();  
		$('#ftrLazySearch').hide(); //common footer
		populateContentResultList(resobj);
    }
    
    function populateContentResultList(resobj){
    	 for(i=0; i<productcount; i++){
    		$('#resultContainer').append(
    			'<p>' +
    				'<b>'+ resobj[i].name + '</b><br>' +
    				''+ resobj[i].description + '<br>' +
    				'in Category :'+ resobj[i].category + '<br>' +
    				'in Stock :'+ resobj[i].count + '<br>' +
    			'</p>'
    		);		 	
    	 }
    }
/*
*/	

    
</script>

</div>
</body>
</html>

