<html> 
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    
    <title>Consumer Assistant</title> 
    <link rel="stylesheet"  href="css/style.css" /> 
    <link rel="stylesheet"  href="css/jquery.mobile-1.2.0.css" />  
</head>

<body> 

<div data-role="page" id="registerconsumer">
 
	<div data-role="header" data-position="fixed" id="hdrMain">
		<div class="headerlogo"> </div>
		<div class="headertext">
		   Register
		</div>
		<div data-role="controlgroup" data-type="horizontal" style="float:right;" >
		    <a href="home.html" rel="external" data-role="button" >Home</a>
			<a href="?" data-role="button" >Back</a>
		</div>
	</div>
 
  	<div data-role="content" id="contentMain"> 
	    <p> Register here to get access to all the functionalities</p>
	    
	    <span id="showErrorMessage" style="color:red;">
			<!-- js populate --> 
		</span>
 
	    <form name="registrationform" >
	        <div data-role="fieldcontain">
		        <label for="username">Username:</label>
		        <input type="text" name="username" id="username" value="" data-mini="true" />
		    </div>
		
		    <div data-role="fieldcontain">
		        <label for="password">Password:</label>
		        <input type="password" name="password" id="password" value="" data-mini="true" />
		    </div>
		
		    <div data-role="fieldcontain">
		        <label for="confirmpassword">Confirm Password:</label>
		        <input type="password" name="confirmpassword" id="confirmpassword" value="" data-mini="true" />
		    </div>
		    <div data-role="fieldcontain">
		        <label for="profiletype">Profile Type:</label>
		        <select id="profiletype" data-native-menu="false" data-mini="true">
		        	<option value="consumer">consumer </option>
		        	<option value="seller">seller </option>
			   	</select>
	    	</div>    

		    
		    
		    <br />
		    <div data-role="fieldcontain">
		        <label for="email">Email:</label>
		        <input type="text" name="email" id="email" value="" data-mini="true" />
		    </div>
		
			<div data-role="fieldcontain">
		        <label for="name">Full Name:</label>
		        <input type="text" name="name" id="name" value="" data-mini="true" />
		    </div>

			<div data-role="fieldcontain">
		        <label for="mobile">Contact No:</label>
		        <input type="text" name="mobile" id="mobile" value="" data-mini="true" />
		    </div>
            <span id="setformerror" style="color:red;">
			<!-- js populate --> 
		 </span>

			
		   	<div class="ui-body">
			<fieldset class="ui-grid-a">
					<div class="ui-block-a"><button type="reset" data-theme="d" data-mini="true">Cancel</button></div>
					<div class="ui-block-b"><button id="registerme" type="submit" data-theme="a" data-mini="true">Submit</button></div>
		    </fieldset>
			</div>
		</form> 
  	</div>
  
  	<div data-role="footer" id="ftrMain">
        <a href="loginConsumer.html" rel="external" data-role="button">Already registered! Take me to login page</a>
  	</div>
  	
  	
  	<!--seller profile page-->
    <!--//
	  	//
	  	//
	  	//
	  	//
	  	//-->
  	
  	
 
	<div data-role="header" data-position="fixed" id="hdrProfileForm">
		<div class="headerlogo"> </div>
		<div class="headertext">
		   Profile
		</div>
		<!--<div data-role="controlgroup" data-type="horizontal" style="float:right;" >
		    <a href="index.html" data-role="button" >Home</a>
			<a href="?" data-role="button" >Back</a>
		</div>-->
	</div>
 
  	<div data-role="content" id="contentProfileForm"> 
	    <p>Add or edit profile</p>
	    
	    <span id="showProfileErrorMessage" style="color:red;">
			<!-- js populate --> 
		</span>
 
	    <form name="sellerprofileform"  >
	        <div data-role="fieldcontain">
		        <label for="displayname">Displayname:</label>
		        <input type="text" name="displayname" id="displayname" value="" data-mini="true" />
		    </div>
		
			<!--
		    <div data-role="fieldcontain">
		        <label for="operatorname">Operatorname:</label>
		        <input type="text" name="operatorname" id="operatorname" value="" data-mini="true" />
		    </div>
		   
		   
		   <div data-role="fieldcontain">
		        <label for="email">Email:</label>
		        <input type="text" name="email" id="email" value="" data-mini="true" />
			    </div>
		   
		    <div data-role="fieldcontain">
		        <label for="contactno">Contact no:</label>
		        <input type="text" name="contactno" id="contactno" value="" data-mini="true" />
		    </div>
		   
		   --> 
			<div data-role="fieldcontain">
		        <label for="address">Address:</label>
		        <input type="text" name="address" id="address" value="" data-mini="true" />
		    </div>

			<div data-role="fieldcontain">
		        <label for="zipcode">Zipcode:</label>
		        <input type="text" name="zipcode" id="zipcode" value="" data-mini="true" />
		    </div>

			<div data-role="fieldcontain">
		        <label for="landmark">Landmark:</label>
		        <input type="text" name="landmark" id="landmark" value="" data-mini="true" />
		    </div>
		    
		    <div data-role="fieldcontain">
		        <label for="nearcity">Nearest City:</label>
		        <input type="text" name="nearcity" id="nearcity" value="" data-mini="true" />
		    </div>
		    
		  
		      <span id="setprofileformerror" style="color:red;">
		      </span>
		   	<div class="ui-body">
			<fieldset class="ui-grid-a">
				 
					<div class="ui-block-a"><button type="reset" data-theme="d" data-mini="true">Cancel</button></div>
					<div class="ui-block-b"><button id="saveprofile" type="submit" data-theme="a" data-mini="true">Save</button></div>
		    </fieldset>
			</div>
		</form> 
  	</div>
  
  	<div data-role="footer" id="ftrProfileForm">
        <h1></h1>
  	</div>
  	
	<!-- contentTransition is displayed after the form is submitted until a response is received back. -->
	<div data-role="content" id="contentTransition" name="contentTransition">	
	 <div align="CENTER"><h4>Please wait.</h4></div>
	 <div align="CENTER"><img id="spin" name="spin" src="css/images/ajax-loader.gif"/></div>
	</div><!-- contentTransition -->
	
	<!-- contentSuccess is displayed after the form is submitted until a response is received back. -->
	<div data-role="content" id="contentProfileSuccess" name="contentProfileSuccess">	
	 <div id="pagenavigateprofile"> </div>
	</div>	<!-- contentProfileSuccess -->

	
	<!-- contentSuccess is displayed after the form is submitted until a response is received back. -->
	<div data-role="content" id="contentSuccess" name="contentTransition">	
	  <div id="pagenavigate"> </div>
	</div>	<!-- contentTransition -->

<script src="js/jquery.js"></script>
<script src="js/jquery.mobile-1.2.0.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
	
	var username="";
    var email="";
	var password="";
    var confirmpassword="";   
    var name="";   
    var profiletype="";         
	var mobile="";
	var geocoder = new google.maps.Geocoder();
	var serviceurl = '../services/accesscontrolaction.php' ;
	$(document).ready(function() {
		showContentMain();
	});

	$('#registerme').click(function () {	
		 username=$("#username").val();
         email=$("#email").val();
		 password=$("#password").val();
         confirmpassword=$("#confirmpassword").val();   
         name=$("#name").val();   
         profiletype=$("#profiletype").val();         
		 mobile=$("#mobile").val();
		
		showTransition();
		doProcessBasicProfile();
		//alert("clickevent");
		return false; // ! mandatory
	});

	
	function doProcessBasicProfile()
	{
		
		if(username==''||email==''||password==''||confirmpassword==''||name==''||mobile==""||profiletype==''){
	    	showContentMain();
			$('#setformerror').append("mandatory fields empty.Please try again");
			return false;
	    }
		
		if (password != confirmpassword) {
			showContentMain();
				$('#showErrorMessage').html("<br />password mismatch !");
			return false;
		}
	
			
		if (profiletype=='consumer')
		{
			doSubmitBasicProfile();
		}
		if (profiletype=='seller')
		{   
			//alert('seller');
			showPageProfileForm();
		}	
		 
   } 
	
	
	function doSubmitBasicProfile()
	{
				
		$.post(
			serviceurl ,
			{ 	
			    username : username,
                email : email,
			    password : password,
  			    name : name,
			    mobile : mobile,
   				action:'registerConsumer' ,	
				profiletype:profiletype 	
			} ,
		 	function(data){
			    var resobj=jQuery.parseJSON(data);
			    //var result=resobj.result;
			    manageRegisterResult(resobj.result);
			}
			  );	
	}
	
		
	function manageRegisterResult(result)
	{	
			//alert("manageregresult");
			if(result){
				showSuccess();
				$('#pagenavigate').html (
					
 				'<div align="CENTER">Successfully Registered <br> Click to navigate to<a rel="external" href="consumerhome.html" > Home Page</a> </div>'
				)
			}
			else{
				showContentMain();
				$('#showErrorMessage').html("<br />unable to complete the registration !");
			}
	}
    
    	
//___________seller profile management___________________________


$('#saveprofile').click(function () {	
		showProfileTransition();
		setLatLong();
		return false; // ! mandatory
	});
	
	function setLatLong(){
		//set the value for global variables latitude and longitude
		var address=$("#nearcity").val();
		geocoder.geocode( { 'address': address}, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
			var latitude = results[0].geometry.location.lat();
			var longitude = results[0].geometry.location.lng();
			doSubmitSellerProfile(latitude, longitude,address);
			}
		});
	}
	
	function doSubmitSellerProfile(latitude, longitude,nearcity)
	{
			
			var displayname=$("#displayname").val();
        	var operatorname=$("#operatorname").val();
			var email=$("#email").val();
        	var address=$("#address").val();   
        	var zipcode=$("#zipcode").val();            
			//var contactno=$("#contactno").val();
			var landmark=$("#landmark").val();	
			if(displayname==''||operatorname==''||address==''||zipcode==''||landmark==''||nearcity=='')
			  { alert("inside");
			  	showProfileContentMain();
	    		$('#setprofileformerror').append("mandatory field empty.please try again");
	    		return false;
			  }
		$.post(
			serviceurl ,
			{ 	
				action:'registerSeller',
			    username : username,
                email : email,
			    password : password,
  			    name : name,
			    mobile : mobile,	
				profiletype:profiletype, 	
				displayname : displayname,
                address:address,
			    zipcode:zipcode,
			    landmark:landmark,
			    nearcity:nearcity,
			    latitude:latitude,
			    longitude:longitude,
			} ,
		 	function(data){
			    var resobj =jQuery.parseJSON(data);
			    manageProfileResult(resobj.result);
			}
			  );	
	}
   
	
	function manageProfileResult(result)
	{
		if(result){
			showProfileSuccess();
			$('#pagenavigateprofile').html (
					
 				'<div align="CENTER">Successfully Registered <br> Click to navigate to<a rel="external" href="sellerhome.html" > Home Page</a> </div>'
				)
		}
		else{
			showPageProfileForm();
			$('#showProfileErrorMessage').html("<br />unable to save profile details !");
			//create a div with id - 'setErrorMsg'
			//set some friendle error message to that div here.	
		}
		
	}
   
      
      function showContentMain()
	{
		$('#contentTransition').hide();
		$('#contentSuccess').hide();
		$('#contentProfileSuccess').hide();
		$('#hdrProfileForm').hide();
		$('#contentProfileForm').hide();
		$('#ftrProfileForm').hide();
		$('#hdrMain').show();
		$('#contentMain').show();
		$('#ftrMain').show();
	}
	
	function showTransition()
	{
		$('#contentMain').hide();
		$('#hdrMain').hide();
		$('#ftrMain').hide();
		$('#contentSuccess').hide();
		$('#contentProfileSuccess').hide();
		$('#hdrProfileForm').hide();
		$('#contentProfileForm').hide();
		$('#ftrProfileForm').hide();
		$('#contentTransition').show();
	}

	function showSuccess()
	{
		$('#contentTransition').hide();
		$('#contentMain').hide();
		$('#hdrMain').hide();
		$('#ftrMain').hide();
		$('#contentProfileSuccess').hide();
		$('#hdrProfileForm').hide();
		$('#contentProfileForm').hide();
		$('#ftrProfileForm').hide();
		$('#contentSuccess').show();
	}
	
	function showPageProfileForm()
	{
		$('#contentTransition').hide();
		$('#contentProfileSuccess').hide();
		$('#contentMain').hide();
		$('#hdrMain').hide();
		$('#ftrMain').hide();
		$('#contentSuccess').hide();
		$('#hdrProfileForm').show();
		$('#contentProfileForm').show();
		$('#ftrProfileForm').show();
	}
	function showProfileContentMain()
	{   
		$('#contentTransition').hide();
        $('#contentProfileSuccess').hide();
        $('#contentMain').hide();
		$('#hdrMain').hide();
		$('#ftrMain').hide();
		$('#contentSuccess').hide();
		$('#hdrProfileForm').show();
		$('#contentProfileForm').show();
		$('#ftrProfileForm').show();
		
	}
	
	
	function showProfileTransition()
	{
		
		$('#contentProfileSuccess').hide();
		$('#hdrProfileForm').hide();
		$('#contentProfileForm').hide();
		$('#ftrProfileForm').hide();
		$('#contentMain').hide();
		$('#hdrMain').hide();
		$('#ftrMain').hide();
		$('#contentSuccess').hide();
		$('#contentTransition').show();
	}

	function showProfileSuccess()
	{
		$('#contentTransition').hide();	
		$('#hdrProfileForm').hide();
		$('#contentProfileForm').hide();
		$('#ftrProfileForm').hide();
		$('#contentMain').hide();
		$('#hdrMain').hide();
		$('#ftrMain').hide();
		$('#contentSuccess').hide();
		$('#contentProfileSuccess').show();
		
	}


</script>

</div>
</body>
</html>


