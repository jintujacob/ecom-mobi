<html> 
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    
    <title>Consumer Assistant</title> 
    <link rel="stylesheet"  href="css/style.css" /> 
    <link rel="stylesheet"  href="css/jquery.mobile-1.2.0.css" />  
</head>

<body> 
<!--using the code for the lazy search form itself -->


<div data-role="page" id="pageSellerProfileProducts">
  
  <!--for populating lazy search form-->
 	<div data-role="header" data-position="fixed" id="hdrLazySearch">
    
	    <div class="headerlogo"> </div>
	    <div class="headertext">
	       Search Products
	    </div>
	    <div data-role="controlgroup" data-type="horizontal" style="float:right;" >
	        <a href="home.html" rel="external" data-role="button" >Home</a>
			<a href="?" data-role="button" >Back</a>
		</div>
  	</div>
 
  	<div data-role="content" id="contentLazySearch"> 
	    
	    <form name="lazysearchform"  >
	    	<div data-role="fieldcontain">
		         <label for="searchkey"> <strong>What to find ?<strong></label><br>
		         <input type="text" name="searchkey"  placeholder="Enter Search Key" id="searchkey" value="" data-mini="true" />
		    </div>      
		         <br>
		          
		         
			<div data-role="fieldcontain">
				<label for="radius" ><strong>Where to find ?</strong></label><br>
				<select name="radius" id="radius" data-native-menu="false" data-mini="true">
					<option>Choose one...</option>
					<option value="10"> 10 miles</option>
					<option value="20">20 miles</option>
					<option value="50">50 miles</option>
					<option value="100">100 miles</option>
				</select>
				 <br>
					<label for="searchaddress"> &nbsp;&nbsp;&nbsp;of </label><br>
		         	<input type="text" name="searchaddress"  placeholder="location or address" id="searchaddress" value="" data-mini="true" />
				
			</div>

	
			
		
		   	<div class="ui-body" >
			<fieldset class="ui-grid-a">
					<div class="ui-block-b"><button align="center" id="locatestore" type="submit" data-theme="a" >Search</button></div>
		    </fieldset>
			</div>
		</form> 
		
  	</div>
	
	<div data-role="content" id="contentResultList" name="contentResultList">	
		 <div id="getProductCount">
	    	<!-- ajax populate -->
	     </div>
	 
		 <div id="resultContainer" >
		 	<!-- ajax populate -->
		 </div>
	</div>
	
	<div data-role="footer" id="ftrLazySearch">
	     <h1>hello</h1>
	</div>
	<!--for populating lazy search form--> 
 

  
  
  	<!--for populating seller profile info div start-->
	<div data-role="header" data-position="fixed" id="hdrProfileInfo">
		<div class="headerlogo"> </div>
		<div class="headertext">
		   Seller Profile 
		</div>
		<div data-role="controlgroup" data-type="horizontal" style="float:right;" >
		    <a href="index.html" data-role="button" >Home</a>
			<a href="?" data-role="button" >Back</a>
		</div>
	</div>
 
  	<div data-role="content" id="contentProfileInfo"> 
	    
	    
	    
  	</div>
  
  	<div data-role="footer" id="ftrProfileInfo">
       
        <div data-role="controlgroup" data-type="horizontal" style="float:center;" >
        	<h1></h1>
       </div>
  	</div>
    <!--____________________________for populating seller profile info div end-->
  
  	<!--for populating seller category info div start-->
	<div data-role="header" data-position="fixed" id="hdrSellerCategory">
		<div class="headerlogo"> </div>
		<div class="headertext">
		   Seller Category 
		</div>
		<div data-role="controlgroup" data-type="horizontal" style="float:right;" >
		    <a href="index.html" data-role="button" >Home</a>
			<a href="?" data-role="button" >Back</a>
		</div>
	</div>
 
  	<div data-role="content" id="contentSellerCategory"> 
	    
	    <div data-role="fieldcontain" >
		     <label for="category">category:</label>
		     <ul  id="ulCategoryList">
				<!--populate content here through ajax call @runtime-->
			 </ul>
	   </div>    
	    
  	</div>
    
  	<div data-role="footer" id="ftrSellerCategory">
       <div data-role="controlgroup" data-type="horizontal" style="float:center;" >
        	<h1></h1>
        	
		</div>
        
  	</div>
  	<!--______________________________for populating seller category info div end-->
  
  	<!--for populating seller product info under a particular category div start-->	
  	<div data-role="header" data-position="fixed" id="hdrProductUnderCategory">
		<div class="headerlogo"> </div>
		<div class="headertext">
		   Products under the Category 
		</div>
		<div data-role="controlgroup" data-type="horizontal" style="float:right;" >
		    <a href="index.html" data-role="button" >Home</a>
			<a href="?" data-role="button" >Back</a>
		</div>
	</div>
 
  	<div data-role="content" id="contentProductUnderCategory"> 
	    
	    <div data-role="fieldcontain" >
		        <label for="products">products:</label>
		        <select id="products" data-mini="true">
		        	<option value="none"> </option>
			   	</select>
	    	</div>    
	    
  	</div>
    
  	<div data-role="footer" id="ftrProductUnderCategory">
       <div data-role="controlgroup" data-type="horizontal" style="float:center;" >
        	<h1></h1>
       </div>
        
  	</div>
  	<!--____________________________for populating seller product info under a particular category div end-->
  
   	<!--for populating a particular product detail div start-->	
  	<div data-role="header" data-position="fixed" id="hdrSoloProductInfo">
		<div class="headerlogo"> </div>
		<div class="headertext">
		   Product Detail 
		</div>
		<div data-role="controlgroup" data-type="horizontal" style="float:right;" >
		    <a href="index.html" data-role="button" >Home</a>
			<a href="?" data-role="button" >Back</a>
		</div>
	</div>
 
  	<div data-role="content" id="contentSoloProductInfo"> 
	    
  	</div>
    
  	<div data-role="footer" id="ftrSoloProductInfo">
       <div data-role="controlgroup" id="ftrCtrlGrpSoloProductInfo" data-type="horizontal" style="float:center;" >
        	<a href="javascript:populateResultList();" data-role="button" >Back to results</a>
       </div>
  	</div>
 	<!--_____________________________for populating a particular product detail div end-->	  
 
 	 
	<!-- contentTransition is displayed after the form is submitted until a response is received back. -->
	<div data-role="content" id="contentTransition" name="contentTransition">	
	 <div align="CENTER"><h4>Please wait.</h4></div>
	 <div align="CENTER"><img id="spin" name="spin" src="css/images/ajax-loader.gif"/></div>
	</div><!-- contentTransition -->
	
</div>	

<!--
	
-->

<script src="js/jquery.js"></script>
<script src="js/jquery.mobile-1.2.0.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

<script type="text/javascript">
	
	// javascript global variable declarations:
	var resobj_search = "" ;
	var resobj_prodlist = "" ;
	var geocoder = new google.maps.Geocoder();
	//var latitude = "";
	//var longitude = "";

	$(document).ready(function() {
		showPageSearchForm();
		
	});

	$('#locatestore').click( function ()  {
		showPageTransition();
		setLatLong();
		return false;  // !mandatory
	});

	
	function setLatLong(address){
		//set the value for global variables latitude and longitude
		var address=$("#searchaddress").val();
		geocoder.geocode( { 'address': address}, function(results, status) {
		  if (status == google.maps.GeocoderStatus.OK) {
		     var latitude = results[0].geometry.location.lat();
		     var longitude = results[0].geometry.location.lng();
		     doProcessInputs(latitude, longitude);
		  } 
		});
	}

    
 	function doProcessInputs(latitude, longitude)
	{
		var searchkey=$("#searchkey").val();
		var radius=$("#radius").val();
		var serviceurl = '../services/geolocateservices.php' ;
		
		$.post(
			serviceurl ,
			{ 	
			    searchkey : searchkey,      
			    radius : radius,
			    lat : latitude,
			    lng : longitude,       
				action:'getSellersByDistance'	
			} ,
		 	function(data){
		 	    resobj_search =jQuery.parseJSON(data);
			    populateResultList();
			}
		);  // end of $.post 
	}
	
	function populateResultList()
	{
		 $('#getProductCount').html(
			resobj_search.length+" Stores found !<br><hr>"
		 );
		 $('#resultContainer').html("");  //clear out previous result since append is used
    	 showPageSearchResults();  
    	 for(var i=0; i<resobj_search.length; i++)
    	 {
    	 	var str = "";
	    		str += '<table><tr>';
	    		str += 	'<td>';
			    str +=		'<p>' ;
			    str +=			'<b>'+ resobj_search[i].display_name + '</b><br>' ;
			    str +=			resobj_search[i].address + '<br>' ;
			    str +=			'Phone : '+ resobj_search[i].ph_no + '<br>' ;
			    str +=			'City : '+ resobj_search[i].near_city + '<br>' ;
			    str +=			'Distance : '+ resobj_search[i].distance + ' miles <br>' ;
			    str +=		'</p>' ;
		    	str +=   '</td></tr>' ;
		    	str +=   '<tr><td>' ;
	    		str +=    	'<a href="javascript:populateContentProfileInfo('+i+');"> View Profile </a>';
	    		str +=   '</td>' ;
	    		str += '</tr></table>  <br><br>';
	    		
    		$('#resultContainer').append(str);		 	
    	 }
    }
  
  /*  
   	function getSellerProfileInfo(sellerid) 
	{
		var serviceurl = '../services/sellerprofileaction.php' ;
		$.post(
			serviceurl ,
			{ 	
			    seller:sellerid,
				action:'getProfileInfo'	
			} ,
		 	function(data){
			    var resobj =jQuery.parseJSON(data);
			    populateContentProfileInfo(resobj);
			}
		);  // end of $.post --
	}
	
*/	
	function populateContentProfileInfo(i)
	{	var str = "";
    			str += '<table "border=0">' ;
    			str += 		'<tr><td>display_name:</td><td><b>'+ resobj_search[i].display_name + '</b></td></tr>' ;
    			str +=		'<tr><td>seller_id:</td><td><b>'+ resobj_search[i].seller_id + '</b></td></tr>' ;
    			str +=		'<tr><td>email:</td><td><b>'+ resobj_search[i].email + '</b></td></tr>' ;
    			str +=		'<tr><td>address:</td><td><b>'+ resobj_search[i].address + '</b></td></tr>' ;
    			str +=      '<tr><td>zipcode:</td><td><b>'+ resobj_search[i].zipcode + '</b></td></tr>' ;
    			str +=		'<tr><td>ph_no:</td><td><b>'+ resobj_search[i].ph_no + '</b></td></tr>' ;
    			str +=		'<tr><td>landmark:</td><td><b>'+ resobj_search[i].landmark + '</b></td></tr>' ;	
    			str +=		'<tr><td>near_city:</td><td><b>'+ resobj_search[i].near_city + '</b></td></tr>' ;	
    			str +=	'</table>';
    			
    			str +=	'<div>';
    			str +=	  "<br><a href='javascript:getSellerCategoryList(\""+resobj_search[i].seller_id+"\");'> Categories  </a><br>" ;
    			str +=	'</div>';
    			
     	 $('#contentProfileInfo').html("");
    	 showPageProfileInfo();
     	 $('#contentProfileInfo').append(str);
    }
    
    function getSellerCategoryList(sellerid) 
    {	
    	showPageTransition();
		var serviceurl = '../services/productsearchutils.php' ;
		$.post(
			serviceurl ,
			{ 	
			    seller:sellerid,
				action:'getSellerCategoryList'	
			} ,
		 	function(data){
			    var resobj =jQuery.parseJSON(data);
			    populateSellerCategoryList(resobj, sellerid);
			}
		);  // end of $.post --
	}
    
    function populateSellerCategoryList(resobj, sellerid) 
    {
		$('#ulCategoryList').html("");
    	showPageSellerCategoryList();
    	for(i=0;i<resobj.length;i++)
    	{
 	    	var str =  "";
 	    		str += '<li>';
 	    		str +=	  "<a style='text-decoration:none;' href='javascript:getProductsUnderCategory(\""+resobj[i].category+"\",\""+sellerid+"\");'> "+resobj[i].category+" </a>" ;
 	    		str += '</li>'	
 	    	$('#ulCategoryList').append(str);
		}
    }
    
    function getProductsUnderCategory(category, sellerid) 
    {
		var serviceurl = '../services/productsearchutils.php' ;
		$.post(
			serviceurl ,
			{ 	
			    seller:sellerid,
			    category:category,
				action:'getProductsUnderCategoryList'	
			} ,
		 	function(data){
			    var resobj =jQuery.parseJSON(data);
			    populateProductsUnderCategory(resobj);
			}
		);  // end of $.post --

	}
    
    function populateProductsUnderCategory(resobj) {
    	resobj_search = resobj;
    	populateResultList();
    }
    
        
	/*    
 	* 
 	function getSoloProductInfo(prod_id) 
 	{
		var serviceurl = '../services/productsearchutils.php' ;
		var prod_id=$("#products").val();
		$.post(
			serviceurl ,
			{ 	
			    prod_id: prod_id,
				action:'getSoloProduct'	
			} ,
		 	function(data){
			    var resobj =jQuery.parseJSON(data);
			    populateSoloProductInfo(resobj);
			}
		);  // end of $.post --

	}
	*/   
    
    function populateSoloProductInfo(i) 
    {  	// i contains the iterator value;
    	// using resobj_search since all the search result is available there;
    	var str = "";
    		str += '<table>';
    		str += '<tr>';
    		str += 	 '<td>Product</td> 		<td>:</td>	<td><b>'+ resobj_search[i].name + '</b></td>' ;
    		str += '</tr><tr>';
    		str += 	 '<td>Description</td> 	<td>:</td>	<td><b>'+ resobj_search[i].description + '</b></td>' ;
    		str += '</tr><tr>';
			str += 	 '<td>Category</td> 	<td>:</td>	<td><b>'+ resobj_search[i].category + '</b></td>' ;
			str += '</tr><tr>';
			str += 	 '<td>Stock</td> 		<td>:</td>	<td><b>'+ resobj_search[i].count + '</b></td>' ;
			str += '</tr><tr>';		
			str += 	 '<td>Seller</td> 		<td>:</td>	<td><b>'+ resobj_search[i].sellerid + '</b></td>' ;
			str += '</tr><tr>';	
			str +=	 "<td><br><a href='javascript:getSellerProfileInfo(\""+resobj_search[i].sellerid+"\");'> Profile </a><br></td>"
			str += '</tr>';    
		    str += '</table> ';
		$('#contentSoloProductInfo').html("");   
		showPageSoloProductInfo();	
		$('#contentSoloProductInfo').append(str);
		
    }

    


		
    
/* page builders --------------------------------*/
	
	function showPageTransition()
	{	
		hideSearchProductForm();
		hideSearchResultList();
		hideSoloProductInfo();
		hideSellerCategory();
		hideProfileInfo();
		hideProductUnderCategory();
		$('#contentTransition').show();
	}
	
	function showPageSearchForm()
	{	
		hideSoloProductInfo();
		hideSearchResultList();
		hideSellerCategory();
		hideProfileInfo();
		hideProductUnderCategory();
		$('#contentTransition').hide();
		showSearchProductForm();
	}
	
	function showPageSearchResults()
	{	
		hideSearchProductForm();
		hideSoloProductInfo();
		hideSellerCategory();
		hideProfileInfo();
		hideProductUnderCategory();
		$('#contentTransition').hide();
		showSearchResultList();
	}	
	
	function showPageProfileInfo()
	{
		hideSearchProductForm();
		hideSearchResultList();
		hideSoloProductInfo();
		$('#contentTransition').hide();
		hideSellerCategory();		
		hideProductUnderCategory();
		showProfileInfo();
	}
	
	function showPageSellerCategoryList()
	{	
		hideSearchProductForm();
		hideSearchResultList();
		hideSoloProductInfo();
		$('#contentTransition').hide();
		hideProfileInfo();
		hideProductUnderCategory();
		showSellerCategory();
	}
	
	function showPageProductsUnderCategory()
	{	
		hideSearchProductForm();
		hideSearchResultList();
		hideSoloProductInfo();
		$('#contentTransition').hide();
		hideSellerCategory();
		hideProfileInfo();
		showProductUnderCategory();
	}
	
	function showPageSoloProductInfo()
	{	
		hideSearchProductForm();
		hideSearchResultList();
		hideSellerCategory();
		hideProfileInfo();
		hideProductUnderCategory();
		$('#contentTransition').hide();
		showSoloProductInfo();
	}

	
	
	function hideSoloProductInfo(){
			$('#hdrSoloProductInfo').hide();	
			$('#contentSoloProductInfo').hide();
			$('#ftrSoloProductInfo').hide();
	}	
		function showSoloProductInfo(){
				$('#hdrSoloProductInfo').show();	
				$('#contentSoloProductInfo').show();
				$('#ftrSoloProductInfo').show();
		}
	
	function hideSellerCategory(){
			$('#hdrSellerCategory').hide();	
			$('#contentSellerCategory').hide();
			$('#ftrSellerCategory').hide();
	}
		function showSellerCategory(){
				$('#hdrSellerCategory').show();	
				$('#contentSellerCategory').show();
				$('#ftrSellerCategory').show();
		}
	
	function hideProfileInfo(){
			$('#hdrProfileInfo').hide();
			$('#contentProfileInfo').hide();
			$('#ftrProfileInfo').hide();
	}
		function showProfileInfo(){
				$('#hdrProfileInfo').show();
				$('#contentProfileInfo').show();
				$('#ftrProfileInfo').show();
		}
	
	function hideProductUnderCategory(){
			$('#hdrProductUnderCategory').hide();
			$('#contentProductUnderCategory').hide();
			$('#ftrProductUnderCategory').hide();
	}
		function showProductUnderCategory(){
				$('#hdrProductUnderCategory').show();
				$('#contentProductUnderCategory').show();
				$('#ftrProductUnderCategory').show();
		}
/*---------------------------------------------*/
	function hideSearchProductForm(){
		$('#hdrLazySearch').hide();
		$('#contentLazySearch').hide();
		$('#ftrLazySearch').hide();
	}
		function showSearchProductForm(){
			$('#hdrLazySearch').show();
			$('#contentLazySearch').show();
			$('#ftrLazySearch').show();
		}

	function hideSearchResultList(){
		$('#hdrLazySearch').hide();
		$('#contentResultList').hide();
		$('#ftrLazySearch').hide();
	}
	function showSearchResultList(){
			$('#hdrLazySearch').show();
			$('#contentResultList').show();
			$('#ftrLazySearch').show();
	}



    
</script>

</div>



</body>
</html>


